import{m as N,_ as y,o as d,c as _,a as e,t as h,E as P,r as f,F as S,b as O,w as V,v as H,d as p,e as u,f as D,n as Y,g as A,h as W,i as X,p as R,j as G}from"./index-wT4GQKR0.js";const Z={data(){return{image:!1,userNameFirstLetter:"",userLastNameFirstLetter:""}},props:{linkToPhoto:{type:String}},computed:{...N(["getUserName","getUserLastName"]),getPhoto(){if(this.linkToPhoto!==null)return this.image=!0,this.linkToPhoto;this.image=!1}},methods:{async updateFirstLetters(){await this.$store.dispatch("getUserInfoById"),this.updateUserNameFirstLetter(),this.updateUserLastNameFirstLetter()},updateUserNameFirstLetter(){const t=this.getUserName;this.userNameFirstLetter=t.charAt(0)},updateUserLastNameFirstLetter(){const t=this.getUserLastName;this.userLastNameFirstLetter=t.charAt(0)}},mounted(){this.updateFirstLetters()}},ee={class:"user__photo"},te=["src"],se={key:1};function ae(t,s,r,c,a,o){return d(),_("div",ee,[a.image?(d(),_("img",{key:0,src:o.getPhoto,alt:""},null,8,te)):(d(),_("div",se,[e("p",null,h(a.userNameFirstLetter),1),e("p",null,h(a.userLastNameFirstLetter),1)]))])}const ne=y(Z,[["render",ae]]),oe={props:{userName:{type:String},userLastName:{type:String}}},ie={class:"user"},re={class:"user__name"},le={class:"user__surname"};function ce(t,s,r,c,a,o){return d(),_("div",ie,[e("div",re,[e("h2",null,h(r.userName),1)]),e("div",le,[e("h2",null,h(r.userLastName),1)])])}const de=y(oe,[["render",ce]]),_e="data:image/svg+xml,%3csvg%20width='20'%20height='20'%20viewBox='0%200%2020%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M6.68878%209.67503V9.6667M13.3554%209.67503V9.6667M6.68878%207.1667V6.33336C6.68878%205.44931%207.03997%204.60146%207.66509%203.97634C8.29021%203.35122%209.13803%203.00003%2010.0221%203.00003C10.9062%203.00003%2011.754%203.35122%2012.3791%203.97634C13.0043%204.60146%2013.3554%205.44931%2013.3554%206.33336V7.1667M6.68878%207.1667H5.72234C4.85552%207.1667%204.13341%207.83113%204.06143%208.69495L3.50587%2015.3616C3.4249%2016.3333%204.19171%2017.1667%205.16678%2017.1667H14.8774C15.8525%2017.1667%2016.6194%2016.3333%2016.5384%2015.3616L15.9828%208.69495C15.9108%207.83113%2015.1887%207.1667%2014.3219%207.1667H13.3554M6.68878%207.1667H13.3554'%20stroke='%23222222'%20stroke-width='1.32143'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",he={data(){return{tariffs:null,tariffsDuration:null,showDuration:!1,tariffsName:null,showPayment:!1,tariffPrice:null,isActiveByType:null,isActiveById:null,durationName:null,tariffId:null,paymentID:null}},computed:{...N(["getUserId"]),userID(){return this.getUserId}},methods:{successPayment(){P({title:"Оплата прошла успешно! ",type:"success"})},errorPayment(){P({title:"Оплата не была произведена. Повторите платёж повторно.",type:"error"})},async getTariffsByUserId(t){console.log(t);let r=await(await fetch(`https://musorok.online:8000/client_tariffs/${t}`)).json();this.tariffs=r.tariffs,console.table(this.tariffs)},showTariffDurationByType(t){this.showDuration=!0,location.href="#duration";let r=this.tariffs.find(a=>a.type===t);this.tariffsName=r.name,this.isActiveByType=r.type;let c=r.tariff_duration;this.tariffsDuration=c,console.log(this.tariffsName),this.showPayment=!1},showTotalSubscription(t){location.href="#price",this.showPayment=!0,this.isActiveById=t.tariff_id,this.durationName=t.duration_info.duration_name,console.log("тут цена",t),this.tariffPrice=t.duration_info.score,this.tariffId=t.tariff_id},async createPayment(){await fetch("https://musorok.online:8000/payment/create_payment/",{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({client_id:this.userID,tariff_id:this.tariffId})}).then(t=>{if(t.ok)return t;throw new Error("Ошибка отправки тарифа")}).then(t=>t.json()).then(t=>{console.log(t),this.paymentID=t.payment_id,console.log(this.paymentID),window.location.href=t.confirmation_url}).catch(t=>{console.error("Ошибка запроса:",t)})}},mounted(){this.getTariffsByUserId(this.userID);function t(r){r=r.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=new RegExp("[\\?&]"+r+"=([^&#]*)"),a=c.exec(location.search);return a===null?"":decodeURIComponent(a[1].replace(/\+/g," "))}var s=t("m");if(s){let r=this.userID;fetch(`https://musorok.online:8000/payment/status_by_client/${r}`).then(c=>{if(c.ok)return c;throw new Error("Ошибка получения информации о платеже")}).then(c=>c.json()).then(c=>{console.log("Получен ответ платежа",c),c.status==="succeeded"?this.successPayment():this.errorPayment()})}}},ue={class:"tariffs"},me=e("div",{class:"tariffs__text"},[e("h4",null,"Выберите тариф")],-1),pe=["onClick"],fe={class:"item__name"},ve=e("div",{class:"item__icon"},[e("img",{src:_e})],-1),ye={class:"item__description"},ge={class:"duration__information",id:"duration"},be=e("div",{class:"tariffs__text"},[e("h4",null,"Выберите срок подписки")],-1),we=["onClick"],De={class:"duration__info"},$e={class:"duration__price"},ke={id:"price",class:"payment"},Ie={class:"payment__info"},Se={class:"payment__description"},Ne={class:"payment__btn"};function Ce(t,s,r,c,a,o){const i=f("el-button");return d(),_(S,null,[e("div",ue,[me,(d(!0),_(S,null,O(a.tariffs,n=>(d(),_("div",{onClick:g=>o.showTariffDurationByType(n.type),class:Y(["tariffs__item",{activeTariffs:a.isActiveByType===n.type}])},[e("div",fe,[e("p",null,h(n.name),1),ve]),e("div",ye,[e("p",null,h(n.description),1)])],10,pe))),256))]),V(e("div",ge,[be,(d(!0),_(S,null,O(a.tariffsDuration,n=>(d(),_("div",{onClick:g=>o.showTotalSubscription(n),class:Y([{activeTariffs:a.isActiveById===n.tariff_id},"tariff__duration"]),key:n.tariff_id},[e("div",De,[e("p",null,h(n.duration_info.duration_name),1)]),e("div",$e,[e("p",null,h(n.duration_info.score)+" руб.",1)])],10,we))),128))],512),[[H,a.showDuration]]),V(e("div",ke,[e("div",Ie,[e("p",null,[p(" Вы выбрали тариф "),e("span",null,'"'+h(a.tariffsName)+'"',1),p(", длительностью на "+h(a.durationName),1)]),e("p",Se,[p(" Стоимость подписки составляет "),e("span",null,h(a.tariffPrice),1),p(" рублей ")])]),e("div",Ne,[u(i,{type:"success",onClick:o.createPayment},{default:D(()=>[p("Перейти к оплате")]),_:1},8,["onClick"])])],512),[[H,a.showPayment]])],64)}const Le=y(he,[["render",Ce]]),Be={components:{Tariffs:Le},data(){return{subscribeDay:null,getSubscribeEndDttm:null,getSubscribeStartDttm:null,userID:null,active:!1}},computed:{...N(["getUserId"])},methods:{async getInfoSubscription(){let s=await(await fetch(`https://musorok.online:8000/client_info/${this.getUserId}`)).json();this.subscribeDay=s.subscribe_days,s.subscribe_end_dttm&&(this.getSubscribeEndDttm=s.subscribe_end_dttm.slice(0,10),this.getSubscribeStartDttm=s.subscribe_start_dttm.slice(0,10)),this.subscribeDay!==null?this.active=!0:this.active=!1}},created(){this.getInfoSubscription()}},Ue={class:"subscription"},Pe={class:"subscription__info"},xe={key:0,class:"info__true"},Te=e("h3",null,"Подписка:",-1),Fe=e("p",null,"Активна",-1),Me=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024","data-v-ea893728":""},[e("path",{fill:"currentColor",d:"M406.656 706.944 195.84 496.256a32 32 0 1 0-45.248 45.248l256 256 512-512a32 32 0 0 0-45.248-45.248L406.592 706.944z"})],-1),Ee=[Te,Fe,Me],Ve={key:0,class:"sub__information"},He={class:"information__date"},Ae={class:"date__block"},qe=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024","data-v-ea893728":""},[e("path",{fill:"currentColor",d:"M512 896a384 384 0 1 0 0-768 384 384 0 0 0 0 768m0 64a448 448 0 1 1 0-896 448 448 0 0 1 0 896"}),e("path",{fill:"currentColor",d:"M480 256a32 32 0 0 1 32 32v256a32 32 0 0 1-64 0V288a32 32 0 0 1 32-32"}),e("path",{fill:"currentColor",d:"M480 512h256q32 0 32 32t-32 32H480q-32 0-32-32t32-32"})],-1),je={class:"date__block"},ze=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024","data-v-ea893728":""},[e("path",{fill:"currentColor",d:"M128 384v512h768V192H768v32a32 32 0 1 1-64 0v-32H320v32a32 32 0 0 1-64 0v-32H128v128h768v64zm192-256h384V96a32 32 0 1 1 64 0v32h160a32 32 0 0 1 32 32v768a32 32 0 0 1-32 32H96a32 32 0 0 1-32-32V160a32 32 0 0 1 32-32h160V96a32 32 0 0 1 64 0zm-32 384h64a32 32 0 0 1 0 64h-64a32 32 0 0 1 0-64m0 192h64a32 32 0 1 1 0 64h-64a32 32 0 1 1 0-64m192-192h64a32 32 0 0 1 0 64h-64a32 32 0 0 1 0-64m0 192h64a32 32 0 1 1 0 64h-64a32 32 0 1 1 0-64m192-192h64a32 32 0 1 1 0 64h-64a32 32 0 1 1 0-64m0 192h64a32 32 0 1 1 0 64h-64a32 32 0 1 1 0-64"})],-1),Oe={class:"date__block"},Ye=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024","data-v-ea893728":""},[e("path",{fill:"currentColor",d:"M128 384v512h768V192H768v32a32 32 0 1 1-64 0v-32H320v32a32 32 0 0 1-64 0v-32H128v128h768v64zm192-256h384V96a32 32 0 1 1 64 0v32h160a32 32 0 0 1 32 32v768a32 32 0 0 1-32 32H96a32 32 0 0 1-32-32V160a32 32 0 0 1 32-32h160V96a32 32 0 0 1 64 0zm-32 384h64a32 32 0 0 1 0 64h-64a32 32 0 0 1 0-64m0 192h64a32 32 0 1 1 0 64h-64a32 32 0 1 1 0-64m192-192h64a32 32 0 0 1 0 64h-64a32 32 0 0 1 0-64m0 192h64a32 32 0 1 1 0 64h-64a32 32 0 1 1 0-64m192-192h64a32 32 0 1 1 0 64h-64a32 32 0 1 1 0-64m0 192h64a32 32 0 1 1 0 64h-64a32 32 0 1 1 0-64"})],-1),Re={key:1,class:"no__active"};function Ge(t,s,r,c,a,o){const i=f("Tariffs");return d(),_("div",Ue,[e("div",Pe,[a.subscribeDay!==null?(d(),_("div",xe,Ee)):A("",!0)]),a.active?(d(),_("div",Ve,[e("div",He,[e("div",Ae,[qe,e("p",null,"Срок действия: осталось "+h(a.subscribeDay)+" дней",1)]),e("div",je,[ze,e("p",null,"Дата активации: "+h(a.getSubscribeStartDttm),1)]),e("div",Oe,[Ye,e("p",null,"Дата окончания: "+h(a.getSubscribeEndDttm),1)])])])):(d(),_("div",Re,[u(i)]))])}const Je=y(Be,[["render",Ge]]),Ke={data(){return{infoData:null,userID:null,selectedDate:null,selectedInterval:null,stateHiddenBtn:this.hiddenBtn}},props:{hiddenBtn:{type:Boolean}},computed:{...N(["getUserId"])},methods:{postStateHiddenBtn(){this.$emit("updateShowBtn",!1)},open1(){let t=this.selectedInterval,s=this.selectedDate;P({title:`Ваше время ${t} и дата: ${s}`,type:"success"})},open2(){let t=this.selectedInterval,s=this.selectedDate;P({title:`Вынос назначен на ${s} в ${t}`,message:"Не забудьте пожалуйста выставить мусор за дверь к началу вашего временного интервала",type:"success",duration:1e4})},open3(){W({message:"Вынос отменен!",type:"info",plain:!0})},selectInterval(t){this.selectedInterval=t,this.open1()},async postDataFreeDelivery(){const t=this.getUserId,s={date:this.selectedDate,interval:this.selectedInterval};console.log("Sending data:",s);try{const r=await fetch(`https://musorok.online:8000/add_delivery/${t}`,{method:"POST",headers:{"Content-Type":"application/json",accept:"application/json"},body:JSON.stringify(s)});if(!r.ok)throw new Error("Ошибка при выполнении запроса");const c=await r.json();console.log("Response data:",c),this.open2();const a=document.querySelector(".position__calendar");a.style.display="none"}catch(r){console.error("Ошибка при обновлении значений переключения:",r)}},selectDate(t){this.selectedDate=t,console.log("Selected Date:",this.selectedDate)}},created(){this.userID=this.getUserId},mounted(){const t=document.querySelector(".calendar h3"),s=document.querySelector(".dates"),r=document.querySelectorAll("#prev, #next"),c=document.querySelector(".info__date");this.getUserId;const a=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"];let o=new Date,i=o.getMonth(),n=o.getFullYear();const g=()=>{let $=new Date(n,i,1).getDay()||7,b=new Date(n,i+1,0).getDate(),k=new Date(n,i,b).getDay(),K=new Date(n,i,0).getDate(),C="";for(let l=$-1;l>0;l--)C+=`<li class="inactive">${K-l+1}</li>`;for(let l=1;l<=b;l++){let m="";l===new Date().getDate()&&i===new Date().getMonth()&&n===new Date().getFullYear()&&(m+=" today activeDay");let I=m!==""?` class="${m}"`:"";C+=`<li${I}>${l}</li>`}for(let l=k+1;l<7;l++)C+=`<li class="inactive">${l-k}</li>`;s.innerHTML=C,t.textContent=`${a[i]} ${n}`;let x=new Date,w=x.getFullYear(),L=x.getMonth()+1,q=x.getDate(),Q=[...s.children];for(const l of Q){let m=parseInt(l.textContent,10);i+1===L&&n===w?m<=q&&l.classList.add("noActive"):(n<w||n===w&&i+1<L)&&l.classList.add("noActive")}function j(){const l=document.querySelectorAll(".modal__variants");for(let m of l){let I=m.firstElementChild;m.firstChild.style.setProperty("background-color","#c8c6c6","important"),I.lastElementChild.style.setProperty("color","#3b3737","important")}}const z=document.querySelector(".modal__btn");z.firstElementChild.addEventListener("click",()=>{const l=document.querySelector(".calendar");l.classList.add("hide__calendar"),setTimeout(()=>{l.style.display="none"},300)}),s.addEventListener("click",l=>{if(j(),l.target.tagName==="LI"&&!l.target.classList.contains("inactive")){const m=document.querySelector(".modal"),I=document.querySelectorAll(".modal__variants");let T=parseInt(l.target.textContent,10),F=i+1,B=n;document.querySelectorAll(".activeDay").forEach(v=>{v.classList.remove("activeDay")}),m.style.display="flex";let M;for(let v of I){let E=v.firstElementChild;v.addEventListener("click",()=>{const U=z.lastElementChild;j(),v.firstChild.style.setProperty("background-color","#66a0d4","important"),E.lastElementChild.style.setProperty("color","white","important"),M=v.textContent.trim(),console.log("Ваш интревал",M),U.style.display="block",U.addEventListener("click",()=>{this.selectedInterval=M,this.postDataFreeDelivery()})})}if(B>w||B===w&&F>L||B===w&&F===L&&T>q){l.target.classList.add("activeDay");let E=a[i].slice(0,-1)+"я";c.innerHTML=`<p>Ваша дата: ${T} ${E}</p>`;let U=`${B}-${String(F).padStart(2,"0")}-${String(T).padStart(2,"0")}`;this.selectDate(U)}}},{once:!0})};r.forEach($=>{$.addEventListener("click",b=>{const k=b.target.id;k==="prev"?i===0?(n--,i=11):i--:k==="next"&&(i===11?(n++,i=0):i++),g()})}),g()}},J=t=>(R("data-v-44be661d"),t=t(),G(),t),Qe={class:"position__calendar"},We={class:"delivery"},Xe=X('<div class="calendar" data-v-44be661d><header data-v-44be661d><h3 data-v-44be661d></h3><nav data-v-44be661d><button id="prev" data-v-44be661d></button><button id="next" data-v-44be661d></button></nav></header><section data-v-44be661d><ul class="days" data-v-44be661d><li data-v-44be661d>Пн</li><li data-v-44be661d>Вт</li><li data-v-44be661d>Ср</li><li data-v-44be661d>Чт</li><li data-v-44be661d>Пт</li><li data-v-44be661d>Сб</li><li data-v-44be661d>Вс</li></ul><ul class="dates" data-v-44be661d></ul></section></div><div class="info__date" data-v-44be661d><p data-v-44be661d>Выберите дату</p></div>',2),Ze={class:"modal"},et={class:"calendar__modal"},tt={class:"modal__variants"},st={class:"modal__variants"},at={class:"modal__variants"},nt={class:"modal__variants"},ot={class:"modal__variants"},it={class:"modal__btn"},rt=J(()=>e("button",null,"Отменить",-1)),lt=[rt],ct=J(()=>e("button",null,"Сохранить",-1)),dt=[ct];function _t(t,s,r,c,a,o){const i=f("el-button");return d(),_("div",Qe,[e("div",We,[Xe,e("div",Ze,[e("div",et,[e("div",tt,[u(i,{class:"variant",plain:"",onClick:s[0]||(s[0]=n=>o.selectInterval("09:00-12:00"))},{default:D(()=>[p(' "09:00-12:00" ')]),_:1})]),e("div",st,[u(i,{class:"variant",plain:"",onClick:s[1]||(s[1]=n=>o.selectInterval("12:00-15:00"))},{default:D(()=>[p(' "12:00-15:00" ')]),_:1})]),e("div",at,[u(i,{class:"variant",plain:"",onClick:s[2]||(s[2]=n=>o.selectInterval("15:00-18:00"))},{default:D(()=>[p(' "15:00-18:00" ')]),_:1})]),e("div",nt,[u(i,{class:"variant",plain:"",onClick:s[3]||(s[3]=n=>o.selectInterval("18:00-21:00"))},{default:D(()=>[p(' "18:00-21:00" ')]),_:1})]),e("div",ot,[u(i,{class:"variant",plain:"",onClick:s[4]||(s[4]=n=>o.selectInterval("09:00-21:00"))},{default:D(()=>[p(' "09:00-21:00" ')]),_:1})])])]),e("div",it,[e("div",{class:"btn__cancel",plain:!0,onClick:s[5]||(s[5]=(...n)=>o.open3&&o.open3(...n))},lt),e("div",{class:"btn__save",plain:!1,onClick:s[6]||(s[6]=(...n)=>o.postDataFreeDelivery&&o.postDataFreeDelivery(...n))},dt)])])])}const ht=y(Ke,[["render",_t],["__scopeId","data-v-44be661d"]]),ut={components:{CalendarFreeDelivery:ht},data(){return{hiddenBtn:!0}},methods:{showModal(){const t=document.querySelector(".position__modal"),s=document.querySelector(".calendar");console.log("working"),s.classList.add("active__modal"),s.style.display="block",t.style.display="block"},onUpdateShowBtn(t){this.hiddenBtn=t}}},mt=t=>(R("data-v-19e49dbb"),t=t(),G(),t),pt=mt(()=>e("button",null,"Тестовый вынос",-1)),ft=[pt],vt={class:"position__modal"};function yt(t,s,r,c,a,o){const i=f("CalendarFreeDelivery");return d(),_(S,null,[V(e("div",{class:"button",onClick:s[0]||(s[0]=(...n)=>o.showModal&&o.showModal(...n))},ft,512),[[H,a.hiddenBtn]]),e("div",vt,[u(i,{onUpdateShowBtn:o.onUpdateShowBtn,hiddenBtn:a.hiddenBtn,class:"calendar"},null,8,["onUpdateShowBtn","hiddenBtn"])])],64)}const gt=y(ut,[["render",yt],["__scopeId","data-v-19e49dbb"]]),bt={components:{UserPhoto:ne,UserName:de,Subscription:Je,BtnAddFreeDelivery:gt},data(){return{userId:null,freeDelivery:null,linkToPhoto:null}},methods:{async getStateBtnById(){let s=await(await fetch(`https://musorok.online:8000/client_info/${this.getUserId}`)).json();console.log(s),this.freeDelivery=s.free_delivery,this.linkToPhoto=s.photo_url}},computed:{...N(["getUserId","getUserName","getUserLastName","getUserToken"]),userId(){return this.getUserId},userName(){return this.getUserName},userLastName(){return this.getUserLastName},userTokenTG(){return this.getUserToken}},created(){this.$store.dispatch("fetchUserId"),this.getStateBtnById()}},wt={class:"content"},Dt={class:"user__info"},$t={class:"info__id"},kt={key:0},It={key:1,class:"text-error"},St={key:0,style:{width:"100%"}};function Nt(t,s,r,c,a,o){const i=f("StopModal"),n=f("UserPhoto"),g=f("UserName"),$=f("BtnAddFreeDelivery"),b=f("Subscription");return d(),_(S,null,[u(i),e("div",wt,[u(n,{linkToPhoto:a.linkToPhoto,class:"user__photo"},null,8,["linkToPhoto"]),e("div",Dt,[u(g,{userName:o.userName,userLastName:o.userLastName},null,8,["userName","userLastName"]),e("div",$t,[o.userId?(d(),_("p",kt,h(o.userId),1)):o.userId?A("",!0):(d(),_("p",It,"id is not defined"))])]),a.freeDelivery===0?(d(),_("div",St,[u($)])):A("",!0),u(b)])],64)}const Ut=y(bt,[["render",Nt]]);export{Ut as default};
