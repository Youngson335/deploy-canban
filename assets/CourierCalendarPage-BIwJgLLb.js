import{m as g,h as S,_ as w,o as k,c as I,a as h,i as L,p as $,j as M,e as b,r as C}from"./index-wT4GQKR0.js";const T={data(){return{infoData:null,userID:null,selectedDate:null,workingDays:[],month:new Date().getMonth(),year:new Date().getFullYear(),dataUser:null,infoClickedDate:null}},computed:{...g(["getUserId"])},methods:{showMessage(e,t){S({message:t,type:e,plain:!0})},async updateIntervalInfo(){const e=document.querySelector(".elements__interval");let t=this.selectedDate,a=null,n=null,i=(await(await fetch(`https://musorok.online:8000/courier_schedule/${this.userID}`)).json()).find(s=>s.schedule_dt===t);i&&(i.start_time.slice(0,2)==="9:"?(a="0"+i.start_time.slice(0,1),n=i.end_time.slice(0,2)):(a=i.start_time.slice(0,2),n=i.end_time.slice(0,2)));let l=`${a}:00-${n}:00`;e.innerHTML=`<p>Интервал: ${l}</p>`},async updateIntervalAfterDeletion(){const e=document.querySelector(".elements__interval");this.selectedDate;const t=document.querySelector(".btn__create");e.innerHTML="<p>У вас выходной!</p>",t.innerHTML="<button>Добавить день</button>"},async handleAddDay(){if(this.selectedDate)try{const e=await fetch(`https://musorok.online:8000/add_working_day/${this.userID}`,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({date:this.selectedDate,interval:"09:00-21:00"})});if(!e.ok)throw new Error("Ошибка при выполнении запроса!");const t=document.querySelector(".btn__create"),a=document.querySelector(".elements__interval"),n=await e.json();console.log("День добавлен:",n),this.updateIntervalInfo(),t.innerHTML="",this.showMessage("success","Рабочий день добавлен!"),await this.renderCalendar()}catch(e){console.error("Ошибка при обновлении дня!",e)}},async handleDeleteDay(){if(this.selectedDate)try{const e=await fetch(`https://musorok.online:8000/delete_working_day/${this.userID}`,{method:"DELETE",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({date:this.selectedDate})});if(!e.ok)throw new Error("Ошибка при выполнении запроса!");const t=await e.json(),a=document.querySelector(".btn__delete");console.log("День успешно удален!",t),a.innerHTML="",this.updateIntervalAfterDeletion(),this.showMessage("success","День успешно удален!"),await this.renderCalendar()}catch(e){console.error("Ошибка при удалении дня",e)}},async fetchWorkingDays(){const e=this.userID,a=await(await fetch(`https://musorok.online:8000/courier_schedule/${e}`)).json();console.log(a),this.dataUser=a,this.workingDays=a.filter(n=>n.is_working_day===1).map(n=>n.schedule_dt)},async renderCalendar(){const e=document.querySelector(".calendar h3"),t=document.querySelector(".dates");document.querySelector(".info__date");const a=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],n=new Date(this.year,this.month,1).getDay()||7,o=new Date(this.year,this.month+1,0).getDate(),r=new Date(this.year,this.month,o).getDay(),i=new Date(this.year,this.month,0).getDate();await this.fetchWorkingDays();let l="";for(let s=n-1;s>0;s--)l+=`<li class="inactive">${i-s+1}</li>`;for(let s=1;s<=o;s++){let c="";s===new Date().getDate()&&this.month===new Date().getMonth()&&this.year===new Date().getFullYear()&&(c+=" today activeDay");let m=s<=9?"0"+s:s,u=this.month+1<=9?"0"+(this.month+1):this.month+1,p=`${this.year}-${u}-${m}`;this.workingDays.includes(p)&&(c+=c?" working":"working");let y=c?` class="${c}"`:"";l+=`<li${y}>${s}</li>`}for(let s=r+1;s<7;s++)l+=`<li class="inactive">${s-r}</li>`;t.innerHTML=l,e.textContent=`${a[this.month]} ${this.year}`,t.querySelectorAll("li").forEach(s=>{s.addEventListener("click",c=>{c.target.classList.contains("inactive")||this.handleDateClick(c)})})},handleDateClick(e){const t=document.querySelector(".info__date"),a=document.querySelector(".elements__interval"),n=document.querySelector(".btn__create"),o=document.querySelector(".btn__delete"),r=parseInt(e.target.textContent,10),i=this.month+1,l=this.year;document.querySelectorAll(".activeDay").forEach(_=>_.classList.remove("activeDay")),e.target.classList.add("activeDay");const c=this.getMonthName(this.month).slice(0,-1)+"я";t.innerHTML=`<p>${r} ${c}</p>`,this.selectedDate=`${l}-${String(i).padStart(2,"0")}-${String(r).padStart(2,"0")}`;const m=this.workingDays.find(_=>_===this.selectedDate),u=new Date,p=new Date(u.getFullYear(),u.getMonth(),u.getDate()+4),y=new Date(this.selectedDate);let d=this.dataUser.find(_=>_.schedule_dt===m),f=null,D=null;d?d.start_time.slice(0,2)==="9:"?(f="0"+d.start_time.slice(0,1),D=d.end_time.slice(0,2)):(f=d.start_time.slice(0,2),D=d.end_time.slice(0,2)):d||(a.innerHTML="<p>Выходной день</p>",document.querySelector(".btn__create").addEventListener("click",this.handleAddDay),o.innerHTML="");let v=`${f}:00-${D}:00`;y>p?m?(a.innerHTML=`<p>Интервал: ${v} </p>`,o.innerHTML="<button>Удалить день</button>",o.replaceWith(o.cloneNode(!0)),document.querySelector(".btn__delete").addEventListener("click",this.handleDeleteDay),n.innerHTML=""):(a.innerHTML="<p>У вас выходной!</p>",n.innerHTML="<button>Добавить день</button>",n.replaceWith(n.cloneNode(!0)),document.querySelector(".btn__create").addEventListener("click",this.handleAddDay),o.innerHTML=""):(n.innerHTML="",d!==void 0?a.innerHTML=`<p>Интервал: ${v} </p>`:a.innerHTML="<p>У вас выходной!</p>")},getMonthName(e){return["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"][e]},prevMonth(){this.month===0?(this.year--,this.month=11):this.month--,this.renderCalendar()},nextMonth(){this.month===11?(this.year++,this.month=0):this.month++,this.renderCalendar()}},async mounted(){this.userID=this.getUserId,await this.renderCalendar(),document.getElementById("prev").addEventListener("click",this.prevMonth),document.getElementById("next").addEventListener("click",this.nextMonth)}},H=e=>($("data-v-3c628f1a"),e=e(),M(),e),q={class:"delivery"},E=L('<div class="calendar" data-v-3c628f1a><header data-v-3c628f1a><h3 data-v-3c628f1a></h3><nav data-v-3c628f1a><button id="prev" data-v-3c628f1a></button><button id="next" data-v-3c628f1a></button></nav></header><section data-v-3c628f1a><ul class="days" data-v-3c628f1a><li data-v-3c628f1a>Пн</li><li data-v-3c628f1a>Вт</li><li data-v-3c628f1a>Ср</li><li data-v-3c628f1a>Чт</li><li data-v-3c628f1a>Пт</li><li data-v-3c628f1a>Сб</li><li data-v-3c628f1a>Вс</li></ul><ul class="dates" data-v-3c628f1a></ul></section></div><div class="info__date" data-v-3c628f1a><p data-v-3c628f1a>Выберите дату</p></div>',2),N={class:"dynamic__еlements"},j=H(()=>h("div",{class:"elements__interval"},null,-1)),x={class:"еlements__btns"};function A(e,t,a,n,o,r){return k(),I("div",q,[E,h("div",N,[j,h("div",x,[h("div",{plain:!0,onClick:t[0]||(t[0]=(...i)=>r.handleDeleteDay&&r.handleDeleteDay(...i)),class:"btn__delete"}),h("div",{plain:!0,onClick:t[1]||(t[1]=(...i)=>r.handleAddDay&&r.handleAddDay(...i)),class:"btn__create"})])])])}const U=w(T,[["render",A],["__scopeId","data-v-3c628f1a"]]),O={components:{CourierCalendar:U},computed:{...g(["getUserId"]),userID(){return this.getUserId}},methods:{postCourierLocation(){navigator.geolocation.getCurrentPosition(e=>{const t=e.coords.latitude,a=e.coords.longitude,n={courier_id:this.userID,latitude:t,longitude:a};fetch("https://musorok.online:8000/courier_locations/",{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)}).then(o=>{if(o.ok)return o;throw new Error("Не удалось получить локацию курьера")}).then(o=>{console.log("отправил локацию в курьерском календаре",o)}).catch(o=>{console.error("Произошла ошибка отправки локации:",o)})})}},mounted(){this.postCourierLocation()}},B=e=>($("data-v-a2527c04"),e=e(),M(),e),P={class:"delivery"},F=B(()=>h("div",{class:"delivery__title"},[h("h1",null,"Календарь оказания услуг")],-1));function W(e,t,a,n,o,r){const i=C("CourierCalendar");return k(),I("div",P,[F,b(i)])}const V=w(O,[["render",W],["__scopeId","data-v-a2527c04"]]);export{V as default};
